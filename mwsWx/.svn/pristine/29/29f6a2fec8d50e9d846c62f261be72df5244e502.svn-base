<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="keywords" content="" />
  		<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport" />
  		<meta content="yes" name="apple-mobile-web-app-capable" />
  		<meta content="black" name="apple-mobile-web-app-status-bar-style" />
  		<meta content="telephone=no" name="format-detection" />
        <link rel="stylesheet" type="text/css" href="css/stylewx.css">
		<title>购物车</title>
	</head>
	<body>
	<div class="sun-shoppingCart">
		<!--订单列表-->	
		<div class="sun-bale-order">
			<div class="sun-bale-name" style="height: 35px;">
				<div class="shop-top"> <i class="icon-choose selected"></i>
					<p>店铺：深圳鹏达汽车厂</p>
				</div>
			</div>
			<div class="sun-bale-order1 order-li">
				<ul>
					<li> <i class="icon-choose selected"></i>
						<a href="#" class="clearfix">
							<div class="sun-order-img">
								<img src="images/search_03.png"></div>
							<div class="sun-order-pro">
								<p>宝德琥珀汽车美容72元洗车优惠券</p>
								<p>
									<span>4G版</span>
									<span>套餐2</span>
								</p>
								<p class="per-price">￥<em>176.23</em></p>
							</div>
							<div class="sun-order-price">
								<span>删除</span>
							</div>
						</a>
						<div class="num-box">
							<span class="choose-reduce noOperate">-</span>
							<span class="choose-num">1</span>
							<span class="choose-add">+</span>
						</div>
					</li>
					<li class="last-li">
						<i class="icon-choose"></i>
						<a href="#" class="clearfix">
							<div class="sun-order-img">
								<img src="images/search_03.png"></div>
							<div class="sun-order-pro">
								<p>宝德琥珀汽车美容72元洗车优惠券</p>
								<p>
									<span>4G版</span>
									<span>套餐2</span>
								</p>
								<p class="per-price">￥<em>176.23</em></p>
							</div>
							<div class="sun-order-price">
								<span>删除</span>
							</div>
						</a>
						<div class="num-box">
							<span class="choose-reduce noOperate">-</span>
							<span class="choose-num">1</span>
							<span class="choose-add">+</span>
						</div>
					</li>
				</ul>
			</div>
		</div>
		<div class="sun-bale-order">
			<div class="sun-bale-name" style="height: 35px;">
				<div class="shop-top">
					<i class="icon-choose"></i>
					<p>店铺：深圳鹏达汽车厂</p>
				</div>
			</div>
			<div class="sun-bale-order1 order-li">
				<ul>
					<li>
						<i class="icon-choose"></i>
						<a href="#" class="clearfix">
							<div class="sun-order-img">
								<img src="images/search_03.png"></div>
							<div class="sun-order-pro">
								<p>宝德琥珀汽车美容72元洗车优惠券</p>
								<p>
									<span>4G版</span>
									<span>套餐2</span>
								</p>
								<p class="per-price">￥<em>176.23</em></p>
							</div>
							<div class="sun-order-price">
								<span>删除</span>
							</div>
						</a>
						<div class="num-box">
							<span class="choose-reduce noOperate">-</span>
							<span class="choose-num">1</span>
							<span class="choose-add">+</span>
						</div>
					</li>
					<li class="last-li">
						<i class="icon-choose"></i>
						<a href="#" class="clearfix">
							<div class="sun-order-img">
								<img src="images/search_03.png"></div>
							<div class="sun-order-pro ">
								<p>宝德琥珀汽车美容72元洗车优惠券</p>
								<p>
									<span>4G版</span>
									<span>套餐2</span>
								</p>
								<p class="per-price">￥<em>176.23</em></p>
							</div>
							<div class="sun-order-price">
								<span>删除</span>
							</div>
						</a>
						<div class="num-box">
							<span class="choose-reduce noOperate">-</span>
							<span class="choose-num">1</span>
							<span class="choose-add">+</span>
						</div>
					</li>
				</ul>
			</div>
		</div>
		<!--失效的商品-->	
		<div class="sun-bale-order noUse-product">
			<div class="sun-bale-name" style="height: 35px;">
				<div class="shop-top">
					<p>失效的商品</p>
				</div>
			</div>
			<div class="sun-bale-order1 order-li">
				<ul>
					<li>
						<a href="#" class="clearfix">
							<div class="sun-order-img">
								<img src="images/search_03.png"></div>
							<div class="sun-order-pro">
								<p>宝德琥珀汽车美容72元洗车优惠券</p>
								<p>
									<span>商品已修改</span>
								</p>
							</div>
							<div class="sun-order-price">
								<span>删除</span>
							</div>
						</a>
					</li>
					<li class="last-li">
						<a href="#" class="clearfix">
							<div class="sun-order-img">
								<img src="images/search_03.png"></div>
							<div class="sun-order-pro">
								<p>宝德琥珀汽车美容72元洗车优惠券</p>
								<p>
									<span>对不起，商品已经卖光了</span>
								</p>
							</div>
							<div class="sun-order-price">
								<span>删除</span>
							</div>
						</a>
					</li>
				</ul>
				<div class="delet-noproduct">
					<p>清空失效的商品</p>
				</div>
			</div>
		</div>

		<!--合计-->	
		<div class="total-pay sun-bottomBox">
		   <span class="total-icon"><i class="icon-choose selected"></i><p>全选</p></span>
		   <span class="total-money"><a href="javascript:;"><p>合计: <em >￥176.23</em></p><p class="delivery-tips">不含运费</p></a></span>
		   <span class="total-btn"><a href="javascript:;">结算(<em>2</em>)</a></span>
		</div>
	</div>


	</body>
</html>

<script type="text/javascript" src="js/jquery-1.7.1.min.js"></script>
<script>
  window.onload=function(){
    //产品数量增加
    $(".sun-shoppingCart").on('click','.choose-add',function(){
     var baseNum=$(this).siblings('.choose-num').text();
     baseNum++;
     $(this).siblings('.choose-num').text(baseNum).end().siblings('.choose-reduce').removeClass('noOperate');
     totalMoney();
    });

    //产品数量减少
    $(".sun-shoppingCart").on('click','.choose-reduce',function(){
     var baseNum=$(this).siblings('.choose-num').text();
     if(baseNum>1){
     	baseNum--;
        $(this).siblings('.choose-num').text(baseNum);
        baseNum==1?$(this).addClass("noOperate"):'';
      }else{
      	$(this).addClass("noOperate");
      }
      totalMoney();
    });

    //选中大产品
    $('.sun-bale-order .sun-bale-name').on('click','.icon-choose',function(){
    	var _this=$(this),
			child=_this.closest(".sun-bale-name").siblings('.order-li').find(".icon-choose"),
			allChoose=$(".total-icon").find('.icon-choose');
    	if(_this.hasClass("selected")){
    		_this.removeClass('selected');
    		child.removeClass('selected');
    		allChoose.removeClass('selected');
    	}else{
    		_this.addClass('selected');
    		child.addClass('selected');
    		$('.icon-choose').length==($(".sun-bale-order .selected").length+1)?allChoose.addClass('selected'):'';
    	}
    	totalMoney();
    });

    //单个选中产品
    $(".sun-shoppingCart .order-li").on('click','.icon-choose',function(){
    	var _this=$(this),
    	    brothers=_this.closest("ul").find('li'),
    	    parentIcon=_this.closest(".order-li").siblings('.sun-bale-name').find('.icon-choose'),//每个店铺全选按钮
    	    allChoose=$(".total-icon").find('.icon-choose');//底部全选按钮
    	    if(_this.hasClass('selected')){
    	    	_this.removeClass('selected');
    	    	brothers.find('.selected').length>1?'':parentIcon.removeClass('selected');
    	    	allChoose.removeClass('selected');
    	    }else{
    	    	 brothers.length-brothers.find('.selected').length==1?parentIcon.addClass('selected'):'';
    	    	 _this.addClass('selected');
    	    	 $('.icon-choose').length==($(".sun-bale-order .selected").length+1)?allChoose.addClass('selected'):'';
    	    }
    	    totalMoney();
    });

    //全选
    $(".total-icon  .icon-choose").click(function(){
    	var _this=$(this),
    	allChooseBox=$(".sun-shoppingCart").find('.icon-choose');
    	if(_this.hasClass('selected')){
    		_this.removeClass('selected');
    		allChooseBox.removeClass('selected');
    	}else{
    		_this.addClass('selected');
    		allChooseBox.addClass('selected');
    	}
    	totalMoney();
    });

   //总价格和总数量
    function totalMoney(){
    	var totalMoney=0,
    	    totalNum=0;
    	$(".sun-bale-order").find('.order-li .selected').each(function(){
    		var _this=$(this),
	    		_num=Number(_this.closest('li').find('.choose-num').text()),
	    		_perPrice=_this.closest('li').find('.per-price em').text();
	    		totalMoney+=_num*_perPrice;
	    		totalNum+=_num;
    	});
    	$(".total-money a").find('em').text('￥'+totalMoney.toFixed(2));
    	$('.total-btn a').find('em').text(totalNum);
    }




  }


</script>
